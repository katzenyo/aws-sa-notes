>[!Warning] On the Exam
> - Architecture is based on creating a feedback loop between logs generated by WAF/apps or ecosystem data in order to update [[Web Application Firewall (WAF)#Web Access Control Lists (WEBACL)|WEBACL]]
> - Mitigates Layer 7 attacks, SQL injection, XSS

## Architecture

![[Pasted image 20230318143441.png]]

## Web Access Control Lists (WEBACL)

- Default Action
	- Allow or Block (non matching)
- Resource Type
	- [[CloudFront Architecture|CloudFront]] or Regional Service
	- ALB, [[API Gateway|API Gateway]], AppSync (pick a region)
- Add Rule Groups or Rules
	- Processed in order
	- Compute requirement based on complexity
- Web ACL Capacity Units (WCU)
	- Default of 1500
	- Can be increased via support ticket
- WEBACL's are associated with resources (takes time)
	- Adjusting WEBACL already associated with a resource takes less time than associating a new one
- One WEBACL can be associated with many resources (one to many relationship)
- Cannot be used with AWS Outposts

## Rule Groups

- Groups of rules
- Don't have default actions
	- Defined when groups or rules are added to WEBACLs
- Managed, your own, or service owned
- Rule groups can be referenced by multiple WEBACLs
- Have a WCU capacity (defined upfront, max 1500)

## WAF Rules

>[!Warning] On the Exam
> - Statements only count the first 8192 bytes of the body

- Type
	- Regular or rate-based
- Statement
	- WHAT to match *or* COUNT all *or* WHAT & COUNT
	- Origin country, IP, label, header, cookies, query parameter, URI path, query string, body (first 8192 bytes only) HTTP method
	- Rules can have a single statement or multiple
		- AND, OR, NOT statements
- Action 
	- Allow, Block, Count, Captcha, Custom Response (`x-amzon-waf-`), Label
	- Labels can be referenced later in the same WEBACL (multi-stage flows)
	- ALLOW & BLOCK actions stop processing
	- Count/Captcha actions continue processing

## Pricing

- WEBACL
	- $5/month (subject to change, can be reused) per
- RULEs on WEBACL
	- $1/month per rule per WEBACL
- REQUESTS per WEBACL
	- $0.60/per million requests
- Intelligent threat mitigation
	- Bot control
		- $10/month and $1/per million requests
	- Captcha
		- $0.40/per 1,000 challenge attempts
	- Fraud Control/Account Takeover
		- $10/month $1/per 1000 login attempts
	- Marketplace Rule Groups
		- Additional costs